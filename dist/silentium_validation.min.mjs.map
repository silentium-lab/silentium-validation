{"version":3,"file":"silentium_validation.min.mjs","sources":["../src/models/Validated.ts","../src/models/ValidationErrors.ts","../src/models/ValidationErrorsHappened.ts","../src/models/ValidationErrorsSummary.ts","../src/models/ValidationErrorsTouched.ts","../src/models/ValidationItems.ts","../src/rules.ts"],"sourcesContent":["import { ValidationErrorType } from \"@/types\";\n\n/**\n * Check if there are any errors in the errors object\n * Returns a boolean type\n *\n * @url https://silentium.pw/article/validated/view\n */\nexport function Validated(errors: ValidationErrorType) {\n  return !Object.values(errors).some(\n    (errorValues: any) => errorValues.length > 0,\n  );\n}\n","import {\n  Actual,\n  All,\n  Applied,\n  DestroyContainer,\n  MaybeMessage,\n  Message,\n  MessageType,\n} from \"silentium\";\nimport { ValidationErrorType, ValidationItem } from \"@/types\";\n\n/**\n * Accepts a set of items that need to be validated\n * and when rules produce values, returns the overall set\n * of errors for the given configuration\n *\n * @url https://silentium.pw/article/validation-errors/view\n */\nexport function ValidationErrors(\n  form: MaybeMessage<ValidationItem[]>,\n): MessageType<ValidationErrorType> {\n  const $form = Actual(form);\n  return Message((resolve, reject) => {\n    const formDc = DestroyContainer();\n    $form.then((form) => {\n      formDc.destroy();\n      const entries = form.map((i) => {\n        return All(\n          i.key,\n          Applied(\n            All(\n              ...i.rules.map((rule) => {\n                return formDc.add(rule(i.value));\n              }),\n            ),\n            (items) => items.filter(ExcludeTrue).map(ErrorFormat),\n          ) as MessageType<string[]>,\n        );\n      });\n      Applied(All(...entries), (e: any) => Object.fromEntries(e))\n        .catch(reject)\n        .then(resolve);\n    });\n  });\n}\n\nfunction ErrorFormat(v: boolean | string) {\n  return v === false ? \"Error!\" : v;\n}\n\nfunction ExcludeTrue(v: boolean | string) {\n  return v !== true;\n}\n","import { ValidationErrorType } from \"@/types\";\n\n/**\n * Show only the errors that exist, fields without errors are not shown\n *\n * @url https://silentium.pw/article/validation-errors-happened/view\n */\nexport function ValidationErrorsHappened(base: ValidationErrorType) {\n  return Object.fromEntries(\n    Object.entries(base).filter((entry) => entry[1].length > 0),\n  );\n}\n","import { ValidationErrorType } from \"@/types\";\n\n/**\n * Overall array of all errors\n *\n * @url https://silentium.pw/article/validation-errors-summary/view\n */\nexport function ValidationErrorsSummary(errors: ValidationErrorType) {\n  return Object.values(errors).flat();\n}\n","import { All, Applied, Chainable, MessageType } from \"silentium\";\nimport { ValidationErrorType } from \"@/types\";\nimport { Dirty, MergeAccumulation } from \"silentium-components\";\n\n/**\n * Validation errors are only those that correspond to changed form fields\n *\n * @url https://silentium.pw/article/validation-errors-touched/view\n */\nexport function ValidationErrorsTouched(\n  $form: MessageType<Record<string, unknown>>,\n  $errors: MessageType<ValidationErrorType>,\n) {\n  const dirtyForm = Dirty($form);\n  Chainable(dirtyForm).chain($form);\n  const touchedForm = MergeAccumulation(dirtyForm);\n  const errorsTouched = All(Applied(touchedForm, Object.keys), $errors);\n  return Applied(errorsTouched, ([touched, errors]) => {\n    return Object.fromEntries(\n      Object.entries(errors).filter((entry) => touched.includes(entry[0])),\n    );\n  });\n}\n","import { ConstructorType } from \"silentium\";\nimport { ValidationRule } from \"@/types\";\n\nexport type FormType = Record<string, unknown>;\nexport type FormRulesType = Record<\n  string,\n  ConstructorType<any, ValidationRule>[]\n>;\n\n/**\n * Get a set of all validation rules\n * for each form field\n *\n * @url https://silentium.pw/article/validation-items/view\n */\nexport function ValidationItems(form: FormType, rules: FormRulesType) {\n  return Object.keys(form)\n    .map((key) => {\n      return {\n        key,\n        value: form[key],\n        rules: rules[key],\n      };\n    })\n    .filter((item) => !!item.rules);\n}\n","/**\n * Validation rule, what requires truthy value\n */\nexport const Required = (v: unknown) => !!v || \"Field required\";\n\n/**\n * Validation rule what requires integer value\n */\nexport const Integer = (v: unknown) => Number.isInteger(v) || \"Must be integer\";\n"],"names":["Validated","errors","Object","values","some","errorValues","length","ValidationErrors","form","$form","Actual","Message","resolve","reject","formDc","DestroyContainer","then","destroy","entries","map","i","All","key","Applied","rules","rule","add","value","items","filter","ExcludeTrue","ErrorFormat","e","fromEntries","catch","v","ValidationErrorsHappened","base","entry","ValidationErrorsSummary","flat","ValidationErrorsTouched","$errors","dirtyForm","Dirty","Chainable","chain","touchedForm","MergeAccumulation","errorsTouched","keys","touched","includes","ValidationItems","item","Required","Integer","Number","isInteger"],"mappings":"+KAQO,SAASA,EAAUC,GACxB,OAAQC,OAAOC,OAAOF,GAAQG,KAC3BC,GAAqBA,EAAYC,OAAS,EAE/C,CCMO,SAASC,EACdC,GAEA,MAAMC,EAAQC,EAAOF,GACrB,OAAOG,EAAQ,CAACC,EAASC,KACvB,MAAMC,EAASC,IACfN,EAAMO,KAAMR,IACVM,EAAOG,UACP,MAAMC,EAAUV,EAAKW,IAAKC,GACjBC,EACLD,EAAEE,IACFC,EACEF,KACKD,EAAEI,MAAML,IAAKM,GACPX,EAAOY,IAAID,EAAKL,EAAEO,UAG5BC,GAAUA,EAAMC,OAAOC,GAAaX,IAAIY,MAI/CR,EAAQF,KAAOH,GAAWc,GAAW9B,OAAO+B,YAAYD,IACrDE,MAAMrB,GACNG,KAAKJ,MAGd,CAEA,SAASmB,EAAYI,GACnB,OAAa,IAANA,EAAc,SAAWA,CAClC,CAEA,SAASL,EAAYK,GACnB,OAAa,IAANA,CACT,CC7CO,SAASC,EAAyBC,GACvC,OAAOnC,OAAO+B,YACZ/B,OAAOgB,QAAQmB,GAAMR,OAAQS,GAAUA,EAAM,GAAGhC,OAAS,GAE7D,CCJO,SAASiC,EAAwBtC,GACtC,OAAOC,OAAOC,OAAOF,GAAQuC,MAC/B,CCAO,SAASC,EACdhC,EACAiC,GAEA,MAAMC,EAAYC,EAAMnC,GACxBoC,EAAUF,GAAWG,MAAMrC,GAC3B,MAAMsC,EAAcC,EAAkBL,GAChCM,EAAgB5B,EAAIE,EAAQwB,EAAa7C,OAAOgD,MAAOR,GAC7D,OAAOnB,EAAQ0B,EAAe,EAAEE,EAASlD,KAChCC,OAAO+B,YACZ/B,OAAOgB,QAAQjB,GAAQ4B,OAAQS,GAAUa,EAAQC,SAASd,EAAM,MAGtE,CCPO,SAASe,EAAgB7C,EAAgBgB,GAC9C,OAAOtB,OAAOgD,KAAK1C,GAChBW,IAAKG,IACG,CACLA,MACAK,MAAOnB,EAAKc,GACZE,MAAOA,EAAMF,MAGhBO,OAAQyB,KAAWA,EAAK9B,MAC7B,CCtBO,MAAM+B,EAAYpB,KAAiBA,GAAK,iBAKlCqB,EAAWrB,GAAesB,OAAOC,UAAUvB,IAAM"}