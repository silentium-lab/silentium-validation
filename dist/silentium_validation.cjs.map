{"version":3,"file":"silentium_validation.cjs","sources":["../src/models/Validated.ts","../src/models/ValidationErrors.ts","../src/models/ValidationErrorsHappened.ts","../src/models/ValidationErrorsSummary.ts","../src/models/ValidationErrorsTouched.ts","../src/models/ValidationItems.ts","../src/rules.ts"],"sourcesContent":["import { ValidationErrorType } from \"@/types\";\n\n/**\n * Check if there are any errors in the errors object\n * Returns a boolean type\n */\nexport function Validated(errors: ValidationErrorType) {\n  return !Object.values(errors).some(\n    (errorValues: any) => errorValues.length > 0,\n  );\n}\n","import {\n  ActualMessage,\n  All,\n  Applied,\n  DestroyContainer,\n  MaybeMessage,\n  Message,\n  MessageType,\n} from \"silentium\";\nimport { ValidationErrorType, ValidationItem } from \"@/types\";\n\n/**\n * Accepts a set of items that need to be validated\n * and when rules produce values, returns the overall set\n * of errors for the given configuration\n */\nexport function ValidationErrors(\n  form: MaybeMessage<ValidationItem[]>,\n): MessageType<ValidationErrorType> {\n  const $form = ActualMessage(form);\n  return Message((resolve, reject) => {\n    const formDc = DestroyContainer();\n    $form.then((form) => {\n      formDc.destroy();\n      const entries = form.map((i) => {\n        return All(\n          i.key,\n          Applied(\n            All(\n              ...i.rules.map((rule) => {\n                return formDc.add(rule(i.value));\n              }),\n            ),\n            (items) => items.filter(ExcludeTrue).map(ErrorFormat),\n          ) as MessageType<string[]>,\n        );\n      });\n      Applied(All(...entries), (e: any) => Object.fromEntries(e))\n        .catch(reject)\n        .then(resolve);\n    });\n  });\n}\n\nfunction ErrorFormat(v: boolean | string) {\n  return v === false ? \"Error!\" : v;\n}\n\nfunction ExcludeTrue(v: boolean | string) {\n  return v !== true;\n}\n","import { ValidationErrorType } from \"@/types\";\n\n/**\n * Show only the errors that exist, fields without errors are not shown\n */\nexport function ValidationErrorsHappened(base: ValidationErrorType) {\n  return Object.fromEntries(\n    Object.entries(base).filter((entry) => entry[1].length > 0),\n  );\n}\n","import { ValidationErrorType } from \"@/types\";\n\n/**\n * Overall array of all errors\n */\nexport function ValidationErrorsSummary(errors: ValidationErrorType) {\n  return Object.values(errors).flat();\n}\n","import { All, Applied, Chainable, MessageType } from \"silentium\";\nimport { ValidationErrorType } from \"@/types\";\nimport { Dirty, MergeAccumulation } from \"silentium-components\";\n\n/**\n * Validation errors are only those that correspond to changed form fields\n */\nexport function ValidationErrorsTouched(\n  $form: MessageType<Record<string, unknown>>,\n  $errors: MessageType<ValidationErrorType>,\n) {\n  const dirtyForm = Dirty($form);\n  Chainable(dirtyForm).chain($form);\n  const touchedForm = MergeAccumulation(dirtyForm);\n  const errorsTouched = All(Applied(touchedForm, Object.keys), $errors);\n  return Applied(errorsTouched, ([touched, errors]) => {\n    return Object.fromEntries(\n      Object.entries(errors).filter((entry) => touched.includes(entry[0])),\n    );\n  });\n}\n","import { ConstructorType } from \"silentium\";\nimport { ValidationRule } from \"@/types\";\n\nexport type FormType = Record<string, unknown>;\nexport type FormRulesType = Record<\n  string,\n  ConstructorType<any, ValidationRule>[]\n>;\n\n/**\n * Get a set of all validation rules\n * for each form field\n */\nexport function ValidationItems(form: FormType, rules: FormRulesType) {\n  return Object.keys(form)\n    .map((key) => {\n      return {\n        key,\n        value: form[key],\n        rules: rules[key],\n      };\n    })\n    .filter((item) => !!item.rules);\n}\n","/**\n * Validation rule, what requires truthy value\n */\nexport const Required = (v: unknown) => !!v || \"Field required\";\n\n/**\n * Validation rule what requires integer value\n */\nexport const Integer = (v: unknown) => Number.isInteger(v) || \"Must be integer\";\n"],"names":["ActualMessage","Message","DestroyContainer","form","All","Applied","Dirty","Chainable","MergeAccumulation"],"mappings":"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"}